{% extends "base.html" %}
{% block title %}products{% endblock %}
{% block content %}
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Donation Form</title>
    <link rel="stylesheet" href="{{url_for('static', filename='donationform.css')}}">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css">
</head>

<body>
    <div class="container mt-5">
        <div class="card wrapper">
            <h2 class="card-title bg-light text-info p-3">Donation Form</h2>
            <form action="" method="post" id="donationForm">

                <!-- Choose a Service Start -->
                <h4 class="text-info">Choose a service</h4>
                <div class="input_box" required>
                    <input type="radio" name="Service" class="radio" id="b1" onclick="toggleLocationDropdown(false)" required>
                    <label for="b1" class="btn btn-outline-info">Pick Up Service</label>
                    <input type="radio" name="Service" class="radio" id="b2" onclick="toggleLocationDropdown(true)" required>
                    <label for="b2" class="btn btn-outline-info">Self-Dropoff</label>
                </div>
                <!-- Choose a Service End -->

                <!-- Address Start -->
                <div class="input-group mb-3">
                    <div class="input_box">
                        <input type="text" placeholder="Address" required class="form-control" id="address" name="address" disabled style="none;">
                        <!---<i class="fa fa-map-marker icon"></i> -->
                    </div>
                </div>

                <!-- Address End -->

                <!-- Location Dropdown Start -->
                <div id="locationDropdown" class="location-dropdown" style="display: none;">
                    <div class="input-group mb-3">
                        <div class="input_box">
                            <label for="dropOffLocation" class="form-label">Select Drop-off Location:</label><br>
                            <select class="form-select" id="dropOffLocation" name="dropOffLocation" disabled>
                                <option value="communityCenter">AMK Community Center</option>
                                <option value="communityCenter">Bedok Community Center</option>
                                <option value="communityCenter">Clementi Community Center</option>
                                <option value="communityCenter">Punggol Community Center</option>
                                <!-- Add more options as needed -->
                            </select>
                        </div>
                    </div>
                </div>
                <!-- Location Dropdown End -->

                <!-- Contact Information -->
                <div class="input-group mb-3">
                    <label for="contactNumber" class="text-info">Contact Information</label>
                    <input type="text" placeholder="E.g. +6591235634" required class="form-control" id="contactNumber" name="contactNumber"
                        maxlength="11" value="" pattern="\+65[689]\d{7}" inputmode="numeric"
                        title="Please enter the +65 and 8 digits of your valid phone number" oninvalid="setCustomValidity('Please enter a valid phone number in the format +6591235634')"
                        oninput="setCustomValidity('')" />
                <!-- Contact Information End -->

                <!-- Schedule Date of Dropoff -->
                <div class="input-group mb-3">
                    <div class="input_box">
                        <h4 class="text-info">Schedule Date</h4>
                        <input type="date" data-date-inline-picker="true" class="form-control" required />
                    </div>
                </div>
                <!-- Schedule Date of Dropoff End -->


                <!-- Schedule Time of Dropoff -->
                <div class="input-group mb-3">
                    <div class="input_box">
                        <h4 class="text-info">Schedule Time</h4>
                        <input type="time" class="form-control" name="scheduleTime" inputmode="numeric" required />
                    </div>
                </div>
                <!-- Schedule Time of Dropoff End -->

                <!-- Dynamic Inputs Start -->
                <label for="quantity" class="form-label">Select Quantity of unique types of donated furniture:</label>
                <!--e.g. user wants to donate chair and table they put 2-->
                <select id="quantity" name="quantity" onchange="generateInputs()" class="form-select" required>
                    <option value="" disabled selected>Select quantity</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <!-- Add more options as needed -->
                </select>
                <div id="dynamicInputsContainer" class="mb-3"></div>
                <!-- Dynamic Inputs End -->

                <!-- Declaration Checkbox Section -->
                <div class="input-group mb-3">
                    <div class="input_box">
                        <h4 class="text-info">Declaration</h4>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="fragile" id="fragileCheckbox" name="fragile">
                            <label class="form-check-label" for="fragileCheckbox">My donated furniture is fragile</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="packaged" id="packagedCheckbox" name="packaged">
                            <label class="form-check-label" for="packagedCheckbox">My donated furniture is already packaged</label>
                        </div>
                    </div>
                </div>
                <!-- Declaration Checkbox Section End -->

                    <!-- Submit and Reset Buttons -->
                    <div class="input-group mb-3">
                        <div class="input-box">
                            <button type="submit" class="btn btn-primary">Submit</button>
                        </div>
                        <div class="input-box">
                            <button type="reset" class="btn btn-secondary reset-button">Reset</button>
                        </div>
                    </div>
                    <!-- Submit and Reset Buttons End -->

            </form>
        </div>
    </div>

    <script>
           function toggleLocationDropdown(enable) {
        var addressInput = document.getElementById('address');
        var dropOffLocationInput = document.getElementById('dropOffLocation');

        if (!enable) {
            // Clear the address field if switching to Physical Dropoff
            addressInput.value = '';
        }

        addressInput.disabled = enable;
        dropOffLocationInput.disabled = !enable;

        if (enable) {
            document.getElementById('locationDropdown').style.display = 'block';
            addressInput.style.display = 'none'; // Hide address input when Physical Dropoff is selected
        } else {
            document.getElementById('locationDropdown').style.display = 'none';
            addressInput.style.display = 'block';
        }
    }

    function generateInputs() {
        var quantity = document.getElementById('quantity').value;
        var container = document.getElementById('dynamicInputsContainer');
        container.innerHTML = ''; // Clear previous inputs

        var selectedFurnitureTypes = []; // To store selected furniture types

        for (var i = 0; i < quantity; i++) {
            var furnitureTypeLabel = document.createElement('label');
            furnitureTypeLabel.textContent = 'Furniture Type ' + (i + 1);

            var furnitureTypeDropdown = document.createElement('select');
            furnitureTypeDropdown.name = 'furnitureType[]'; // Use an array for multiple inputs
            furnitureTypeDropdown.classList.add('form-select');

            // Add default option
            var defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.text = 'Select quantity of unique furniture type here';
            defaultOption.disabled = true;
            furnitureTypeDropdown.add(defaultOption);

            // Reset default option when the page is loaded
            document.addEventListener('DOMContentLoaded', function () {
                var defaultOption = document.querySelector('#dynamicInputsContainer select option[value=""]');
                if (defaultOption) {
                    defaultOption.disabled = false; // Enable the default option
                }
            });

            // Add other options to the dropdown (you can customize this list)
            var furnitureTypeOptions = ['Select quantity of unique furniture type here', 'Chairs', 'Tables', 'Television'];
            for (var j = 1; j < furnitureTypeOptions.length; j++) {
                var option = document.createElement('option');
                option.value = furnitureTypeOptions[j];
                option.text = furnitureTypeOptions[j];
                furnitureTypeDropdown.add(option);
            }

            furnitureTypeDropdown.addEventListener('change', function (event) {
                // Check if the selected furniture type is already selected
                if (selectedFurnitureTypes.includes(event.target.value)) {
                    alert('Furniture type already selected. Please choose a different type.');
                    event.target.value = ''; // Reset the selection
                } else {
                    selectedFurnitureTypes[i] = event.target.value;
                    // Disable the default option after a selection is made
                    defaultOption.disabled = true;
                }
            });

            var quantityLabel = document.createElement('label');
            quantityLabel.textContent = 'Quantity of Furniture Type ' + (i + 1);

            var quantityInput = document.createElement('input');
            quantityInput.type = 'number';
            quantityInput.name = 'quantity[]'; // Use an array for multiple inputs
            quantityInput.classList.add('form-control');

            container.appendChild(furnitureTypeLabel);
            container.appendChild(furnitureTypeDropdown);
            container.appendChild(quantityLabel);
            container.appendChild(quantityInput);
        }
    }

    // Validate form before submission
document.getElementById('donationForm').addEventListener('submit', function (event) {
    var selectedOptions = document.querySelectorAll('#dynamicInputsContainer select');
    var quantityInputs = document.querySelectorAll('#dynamicInputsContainer input[type="number"]');
    var dateInput = document.querySelector('input[type="date"]');
    var timeInput = document.querySelector('input[type="time"]');
    var serviceInputs = document.querySelectorAll('input[name="Service"]');

    // Check for duplicate furniture types
    var selectedFurnitureTypes = Array.from(selectedOptions).map(function (select) {
        return select.value;
    });

    if (new Set(selectedFurnitureTypes).size !== selectedFurnitureTypes.length) {
        alert('Duplicate furniture types found. Please select unique types.');
        event.preventDefault(); // Prevent form submission
        return;
    }

    // Check if any required field is empty
    for (var i = 0; i < selectedOptions.length; i++) {
        if (selectedOptions[i].value === '' || selectedOptions[i].value === 'Select quantity of unique furniture type here' || quantityInputs[i].value === '') {
            alert('Please fill in all the fields.');
            event.preventDefault(); // Prevent form submission
            return;
        }
    }

    // Check if Schedule Date, Schedule Time, and Service are filled
    if (dateInput.value === '' || timeInput.value === '') {
        alert('Please fill in the Schedule Date and Schedule Time.');
        event.preventDefault(); // Prevent form submission
        return;
    }

    var serviceChecked = false;
    for (var j = 0; j < serviceInputs.length; j++) {
        if (serviceInputs[j].checked) {
            serviceChecked = true;
            break;
        }
    }

    if (!serviceChecked) {
        alert('Please choose a service (Pick Up or Self-Dropoff).');
        event.preventDefault(); // Prevent form submission
        return;
    }
});
</script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
</body>

{%endblock%}
